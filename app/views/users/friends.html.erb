<% content_for :local_script do %>
  <div id="fb-root"></div>
  <script>
    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s);
      js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>

  <script type="text/javascript">

    window.fbAsyncInit = function() {
      FB.init({
        appId      : '<%= configatron.facebook_app_id %>', // App ID
        status     : true, // check login status
        cookie     : true, // enable cookies to allow the server to access the session
        xfbml      : true  // parse XFBML
      });
      
      FB.getLoginStatus(function(response)
      {
        if(response.status === 'connected') {
          // connected
          testAPI();
        } else if (response.status === 'not_authorized') {
          // not_authorized
          alert("not authorixed")
          login();
        } else {
          // not_logged_in
          //setTimeout(login, 1000);
          alert("not authorixed else")
          login();
        }
      });
      
    }

    function login() {
      FB.login(function(response) {
        if (response.authResponse) {
          // connected
          testAPI();
        } else {

        }
      });
    }

    function testAPI() {
      FB.api('/me/friends', { fields: 'name,id,picture' }, function(response) {
        jQuery.ajax({
          url: "<%= friends_list_home_index_url %>",
          data: JSON.stringify(response),
          type: 'POST',
          dataType: 'script', 
          contentType: "application/json",
          error : function(xhr, status, response) {
            alert(response);
          }

        });
      });
    }

    //Facebook Send Message to a friend
    $(document).on('click', '.button-facebook-friend-invite', function(e){
      e.preventDefault();
      facebook_send_message($(this).attr('id'), '<%#= j current_user.name %>',
                                                '<%#= j get_profile_image_full_path %>');
    });
  </script>
<% end %>

<div class="container" style="width: 800px;">
  <div class="jQueryFriends"></div>
  </div>
<div class="myvision_container">
  <div class="row-fluid">
    <div class="span12 frinds_container_padding">
      <!-- Details view start here -->
      <div class="row-fluid" >
        <div class="span4"> 
          <div class="myvision_title span">
            My Friends 
          </div>
          <div class="">
            Click on friends below to see their profile and shows, or add new ones at right.
          </div>
        </div>
        <div class="span8">
          <div class="margin_bottom_si" > 
            <%= link_to raw("<i class=\"sprite-facebook-white \"></i>Add from Facebook"), invite_facebook_friends_home_index_path, :class=>"btn  btn-primary " %>
            <a class="btn  btn-info " href="#"><i class="sprite-twitter-white"></i>Add from Twitter</a>
          </div>

          <div class="input-prepend input-append search_padding">
            <span class="add-on prepend_background" ><i class="icon-search"></i></span>
            <input type="text" placeholder="Search by Name or Email"  class="input-xlarge">
            <span class="add-on btn-warning">Go</span>
          </div>
        </div>
      </div>

      <ul class="thumbnails">
        <li class="span12">
          <div class="thumbnail frinds_thumbnail_padding" >
            <div class="row-fluid frinds_row_margin">
              <div class="span4"> 
                <div class="row-fluid"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/OCP0154256_P_Portrait-of-a-young-man.png" alt="300x200" >
                    </div> 
                  </div>
                  <div class="span8">
                    <div class="friend_name"> <%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
              <div class="span4"> 
                <div class="row-fluid"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/1624747_P_Businesswoman-in-front-of-people.png" alt="300x200" >
                    </div> 
                  </div>
                  <div class="span8">
                    <div class="friend_name"><%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
              <div class="span4"> 
                <div class="row-fluid"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/AYP1251924_P_USA-California-Los-Angeles-Portrait.png" alt="300x200" >
                    </div> 
                  </div>
                  <div class="span8">
                    <div class="friend_name"> <%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row-fluid  ">
              <div class="span4"> 
                <div class="row-fluid frinds_row_margin"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/1624747_P_Businesswoman-in-front-of-people.png" alt="300x200" >
                    </div> 
                  </div>
                  <div class="span8">
                    <div class="friend_name"> <%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
              <div class="span4"> 
                <div class="row-fluid"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/AYP1251924_P_USA-California-Los-Angeles-Portrait.png" alt="300x200" >
                    </div> 
                  </div>
                  <div class="span8">
                    <div class="friend_name"> <%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
              <div class="span4"> 
                <div class="row-fluid"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/OCP0154256_P_Portrait-of-a-young-man.png" alt="300x200" >
                    </div> 
                  </div>
                  <div class="span8">
                    <div class="friend_name"> <%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row-fluid  ">
              <div class="span4"> 
                <div class="row-fluid frinds_row_margin"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/OCP0154256_P_Portrait-of-a-young-man.png" alt="300x200" >
                    </div> 
                  </div>
                  <div class="span8">
                    <div class="friend_name"> <%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
              <div class="span4"> 
                <div class="row-fluid"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/1624747_P_Businesswoman-in-front-of-people.png" alt="300x200" >
                    </div> 
                  </div>
                  <div class="span8">
                    <div class="friend_name"> <%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
              <div class="span4"> 
                <div class="row-fluid"> 
                  <div class="span4">
                    <div class="friend_image"> 
                      <img  src="/assets/AYP1251924_P_USA-California-Los-Angeles-Portrait.png" alt="300x200" >
                    </div>
                  </div>
                  <div class="span8">
                    <div class="friend_name"> <%= link_to "Jane Doe", friend_profile_user_path(current_user.id, :friend_id => User.last.id) %></div>
                    <div class="friends_show"> 3 shows,&nbsp;<a class="frinds_cameos">12 cameos </a> </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </li>

      </ul>

      <!-- Details view end here -->
    </div>
  </div>

</div>