<!-- Test1 working html file to use webcam & microphone  -->
<!-- Ref:
  http://www.html5rocks.com/en/tutorials/getusermedia/intro/ & Other JS FIddle Page 
-->

<%= form_tag "/shows/test2" do %>
  <video autoplay="" class="videostream" id="basic-stream" tabindex="0" name='recorded_video_file'></video>
  <%= hidden_field_tag "input_video_file", '', :id => "input_video_file"  %>
  <p>
    <button id="capture-button" type="button">Capture video</button>
    <button id="stop-button" type="button">Stop</button>
  </p>
  <%= submit_tag "Save" %>
<% end %>

<% content_for :js_with_script_tags do %>
  <!-- // <script src="/home/qwinix/Desktop/test01/jquery.js" type="text/javascript"></script> -->
  <!-- // <script src="http://code.jquery.com/jquery-1.9.1.js"></script> -->
  <script type='text/javascript'>
    (function ($) {
      window.URL = window.URL || window.webkitURL;
      navigator.getUserMedia  = navigator.getUserMedia || navigator.webkitGetUserMedia ||
              navigator.mozGetUserMedia || navigator.msGetUserMedia;
      var video = document.querySelector('video');
      var onFailSoHard = function(e) {
        console.log('Reeeejected!', e);
      };
      $('#capture-button').click (function () {
        console.log ("capture click!");
        if (navigator.getUserMedia) {
          // alert('1');
          // Not showing vendor prefixes.
          navigator.getUserMedia({video: true, audio: true}, function(localMediaStream) {
            var video = document.querySelector('video');
            video.src = window.URL.createObjectURL(localMediaStream);
      
            // Note: onloadedmetadata doesn't fire in Chrome when using it with getUserMedia.
            // See crbug.com/110938.
            video.onloadedmetadata = function(e) {
                // Ready to go. Do some stuff.
            };
          }, onFailSoHard);
        } else {
          alert('not supported in this browser');
          video.src = 'somevideo.webm'; // fallback.
        }
      });
      $('#stop-button').click (function (e) {
        video.pause ();
        // localMediaStream.stop ();
        $("#input_video_file").val(video.src);
      });
    })(jQuery);
  </script>
<% end %>
